# 🧪 화학물질 관리 시스템 (KOSHA API 연동 버전)

화학물질 **인벤토리 관리 + 배출량 산정 + KOSHA API 연동**이 통합된 Streamlit 앱입니다.

## ✨ 주요 기능

### 📋 인벤토리 관리
- 사업장별 화학물질 목록 관리
- 규제 정보 (작업환경측정, 특수건강진단, CMR 등)
- 검색 및 필터링
- 엑셀 다운로드

### 🔍 KOSHA API 연동 (신규!)
- **CAS 번호 → 자동 규제정보 조회**
- 개별 조회: CAS 번호 입력 → 즉시 결과
- 일괄 조회: 인벤토리 전체 자동 채움
- 조회 항목:
  - 물질명, 노출기준(TWA/STEL)
  - 작업환경측정, 특수건강진단 대상 여부
  - 관리대상유해물질, 특별관리물질
  - 발암성(CMR), IARC, ACGIH
  - 유독물질, 사고대비물질
  - PRTR 대상 여부

### 📊 배출량 산정 (통합환경법 기준)
- **Tier 1**: TMS 자동측정
- **Tier 2**: 자가측정
- **Tier 3**: 물질수지법
- **Tier 4**: 배출계수법
- 개별 산정 + 엑셀 일괄 산정

### 🔐 보안
- 사용자별 로그인
- 사업장별 접근 권한 분리
- 관리자/담당자 권한 구분

## 📁 폴더 구조

```
chemical_inventory_system/
├── chemical_inventory_app.py    # 메인 앱
├── kosha_api.py                 # KOSHA API 모듈
├── prtr_substances.py           # PRTR 대상물질 DB (신규!)
├── config.yaml                  # 사용자 설정
├── requirements.txt             # 패키지 목록
├── data/
│   └── companies/               # 사업장별 인벤토리
│       └── 신우중공업_인벤토리.xlsx
└── README.md
```

## 🚀 실행 방법

### 1. 패키지 설치
```bash
pip install -r requirements.txt
```

또는:
```bash
pip install streamlit pandas openpyxl pyyaml bcrypt requests
```

### 2. 앱 실행
```bash
streamlit run chemical_inventory_app.py
```

### 3. 브라우저 접속
```
http://localhost:8501
```

## 🔑 기본 계정

| 구분 | ID | PW | 권한 |
|------|-----|------|------|
| 관리자 | `admin` | `admin123` | 전체 |
| 담당자 | `shinwoo` | `shinwoo123` | 신우중공업만 |

## 📊 메뉴 구성

| 메뉴 | 관리자 | 담당자 | 설명 |
|------|--------|--------|------|
| 🏠 대시보드 | ✅ | ✅ | 현황 요약 |
| 📋 인벤토리 조회 | ✅ | ✅ | 화학물질 검색/필터 |
| 🔍 KOSHA 조회 | ✅ | ✅ | **CAS → 규제정보 자동조회** |
| 📊 배출량 산정 | ✅ | ✅ | 개별/일괄 배출량 계산 |
| 📤 데이터 업로드 | ✅ | ❌ | 인벤토리 업로드 |
| 🏢 사업장 관리 | ✅ | ❌ | 사업장 목록 관리 |
| 👥 사용자 관리 | ✅ | ❌ | 계정 관리 |

## 🔍 KOSHA 조회 사용법

### 개별 조회
1. 🔍 KOSHA 조회 메뉴 클릭
2. "개별 조회" 탭 선택
3. CAS 번호 입력 (예: `67-64-1`)
4. [조회] 버튼 클릭
5. 규제정보 즉시 확인

### 인벤토리 일괄 조회
1. 🔍 KOSHA 조회 메뉴 클릭
2. "인벤토리 일괄 조회" 탭 선택
3. [일괄 조회 시작] 버튼 클릭
4. 자동으로 모든 CAS 번호 조회
5. 인벤토리에 결과 자동 저장

## 📈 인벤토리 컬럼

### 기존 컬럼 (23개)
- 공정명, 제품명, 화학물질명, 관용명/이명, CAS No, 함유량
- 발암성, 변이성, 생식독성, 노출기준(TWA)
- 작업환경측정, 특수건강진단, 관리대상유해물질, 특별관리물질
- 기존, 유독, 사고대비, 제한/금지/허가, 중점, 잔류
- 함량 및 규제정보, 등록대상기존화학물질, 기존물질여부

### 배출량 컬럼 (7개)
- 연간취급량(kg), 대기배출량(kg/년), 수계배출량(kg/년)
- 폐기물이동량(kg/년), 배출산정방법, 산정기준일, PRTR대상여부

### KOSHA 조회 컬럼 (2개, 신규)
- KOSHA조회상태, KOSHA조회일

## 🔧 KOSHA API 정보

- **API 제공**: 안전보건공단
- **엔드포인트**: `https://msds.kosha.or.kr/openapi/service/msdschem`
- **조회 항목**:
  - `chemlist`: 물질 검색
  - `chemdetail08`: 노출기준
  - `chemdetail11`: 유해성 분류
  - `chemdetail15`: 법적 규제현황

## 🔜 향후 확장 계획

1. **MSDS 자동 생성**
   - 16개 항목 자동 채움
   - Word/PDF 출력

2. **자동 보고서 생성**
   - 화학물질 위험성평가 보고서
   - 호흡기보호프로그램
   - PRTR 신고서

3. **법규 AI 챗봇**
   - 산업안전보건법 Q&A
   - 화학물질관리법 Q&A

---

© 2025 Kay's Chem Manager | KOSHA API 연동
